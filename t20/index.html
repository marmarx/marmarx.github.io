<!DOCTYPE html>
<html>
<head>
<title>Ficha T20 Mobile - v0.5</title>
<meta name="author" content="Marco Martins">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#FF385C">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Lora:wght@500;600&family=Open+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<script type="text/javascript" src="db/skills.txt"></script>
<script type="text/javascript" src="db/conditions.txt"></script>
<script type="text/javascript" src="db/spells.txt"></script>
<script type="text/javascript" src="db/geral.txt"></script>

<style>
:root{--pv:#FF4466;--pm:#4BC7CF;--menu:#FF385C;--drawer:#dbdbdb;--diceroller:#e9e9e9;--black:#292929;--white:#fff;--overlay:#e8e8e8}
*,*:before,*:after{margin:0;padding:0;transition:all .7s ease-in-out;font-family:'Open Sans', sans-serif;color:var(--black);word-wrap:normal;word-break:keep-all;box-sizing:border-box}
html,body{overflow-x:hidden;width:100vw;min-height:100vh}
::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:#bbb}::-webkit-scrollbar-thumb:hover{background:#999}
::-webkit-scrollbar:horizontal{display:none}
body::-webkit-scrollbar{display:none}

.row{display:inline-flex;position:relative;width:100%}
.container{margin:auto;width:80%;display:inline-flex}
.half,.third{float:left;width:100%}
@media (min-width:991px){.half{width:49.99999%}.third{width:33.33333%}}

h1,h2{text-align:center;margin:.5em 0;letter-spacing:4px;font-family:'Lora', serif;color:var(--white);text-shadow:2px 2px 3px #252525,2px 2px 5px #252525}
h1{font-size:3.6em;font-weight:500}h2{font-size:1.8em;text-transform:uppercase;font-weight:600}
h3,h4,p,li{line-height:1.8em;letter-spacing:.8px;text-align:justify}
h3{font-size:2em}h4{font-size:1.4em}h3,h4{font-weight:400;margin-top:1.5em}
p,li{font-size:1.2em;font-weight:300;margin:.5em 0}
ul{margin:2em}b,.bold{font-weight:bold}i,.italic{font-style:italic}

#sections{width:900vw;position:relative;display:flex}
.sec{width:100vw;min-height:100vh;float:left;padding:25px 25px 125px 25px}
#dice_roller,#drawer{border-top-left-radius:25px;border-top-right-radius:25px}
#dice_roller{position:fixed;width:100vw;height:105px;background:var(--diceroller);bottom:0}
#drawer{width:100vw;height:35px;padding:15px 35%;background:var(--drawer)}.drew{height:95vh!important}
#drawer div{width:100%;height:100%;background:var(--white);border-radius:5px}
#dice{position:relative;padding:0 25px;width:100%;bottom:0}
#dice-pick{position:absolute;bottom:0}

nav{position:fixed;left:0;bottom:0;height:70px;width:100vw;background:var(--white);border-top:1px solid #EBEBEB;overflow-x:scroll;overflow-y:hidden}
#menu{display:inline-flex}
.menubtn{width:20vw;height:70px;float:left;display:inline-flex;cursor:pointer}.menubi{margin:auto}
.menuicon{color:#b0b0b0;width:fit-content;margin:auto}
.menuicon svg{display:block;height:24px;width:24px;overflow:visible;fill:currentcolor}
.menuicon path{color:#b0b0b0}.menuselicon path{color:var(--menu)}
.menutext{font-size:.625em;font-weight:600;color:#717171;margin-top:.2em;padding:.1em 0 .5em}.menuseltext{font-weight:700}

#res_test{margin:auto}#spells_list{display:block}
.spell{cursor:pointer;border:1px solid transparent;border-radius:10px}
.more_info{border-color:rgba(32,32,32,.4);margin:.5em 0}
.item_title,.item_subtitle{margin:0}.item_title{font-size:1em;font-weight:500;display:inline-flex}.item_subtitle{font-size:.8em}
.item_action{margin-right:0}p.item_subtitle{max-height:unset}
.hid{visibility:hidden;margin:0;max-height:0;overflow:hidden}
.nowrap{word-break:break-all;margin:0;font-size:1em}

.ac_livre,.ac_movimento,.ac_padrão,.ac_completa,.ac_padrão:before,.ac_completa:before,.ac_completa:after{width:12px;height:12px;border:1px solid var(--overlay);display:block}
.ac_livre,.ac_movimento,.ac_padrão,.ac_completa{transform:rotate(45deg)}
.ac_livre{border:1px solid #b3b2b2}
.ac_movimento,.ac_padrão,.ac_completa,.ac_padrão:before,.ac_completa:before,.ac_completa:after{background:#b3b2b2}
.ac_padrão:before,.ac_completa:before,.ac_completa:after{content:''}.ac_padrão:before,.ac_completa:before{transform:translate(4px,-6px)}.ac_completa:after{transform:translate(9px,-23px)}
.ac_reação{width:14px;height:14px;border:2px solid;border-right-color:transparent;border-radius:100px;transform:rotate(135deg)}.ac_reação:before{content:"";position:absolute;width:6px;height:6px;border-top:2px solid;border-right:2px solid;top:-3px;right:-1px;transform:rotate(68deg)}.ac_reação,.ac_reação:before{color:#b3b2b2}
.divider{width:70%;height:2px;margin:1em auto;background:rgba(32,32,32,.2)}

.input{position:relative;width:100%;margin:18px 0}
.fakeinput,input,select{border:1px solid #b0b0b0;border-radius:5px;font-size:1.1em;line-height:1.2em;-webkit-appearance:none;padding:1.6em 1.3em .5em;background:var(--white)}
.fakeinput,input,select,label{width:100%}
label{position:absolute;left:0;top:0;pointer-events:none;color:#717171;padding:1.3em 1.6em}
input:focus ~ label,input:not(:focus):valid ~ label,select:focus ~ label,select:not(:focus):valid ~ label,.fakeinput:focus ~ label,.fakeinput:not(:empty) ~ label{font-size:.7em;padding:.4em 2.1em;margin:.3em 0;left:2px}
.select{padding:.8em;margin:0}
input[type="file"]{display:none}
label[for="file"]{position:relative;pointer-events:all}

.fakeinput{height:60.06px;cursor:text;white-space:nowrap;overflow:hidden}.fakeinput:focus{outline:1px auto #141414}

button,label[for="file"]{padding:14px 26px;text-align:center;text-decoration:none;display:inline-block;font-size:100%;margin:10px 0;cursor:pointer;border-radius:5px; width:100%;background:transparent;border:2px solid var(--black);color:var(--black);font-weight:600}
button:hover,button:focus,label[for="file"]:hover,label[for="file"]:focus{background:var(--black);color:#e8e8e8}
button.delete{border:2px solid #ef5d5d;color:#ef5d5d}button.delete:hover{background:#ef5d5d;color:var(--white)}
button:disabled,button:hover:disabled{border:2px solid #b0b0b0;color:#b0b0b0;background:var(--white);cursor:no-drop}

a{color:black;padding:12px 30px;text-decoration:none;display:block}
a:hover{background-color:#1e90ff;color:var(--white)}
.dropdown{position:absolute;background-color:var(--white);border:1px solid #000;z-index:1;width:100%;top:60px;max-height:250px;overflow-y:scroll}
.dn{display:none!important;border:0}

.backdrop,.overlay{width:100vw;left:0;top:0}
.backdrop{height:100vh;position:fixed;top:0;background:hsl(0 0% 10%/.5);backdrop-filter:blur(2px)}
.overlay{height:90vh;max-height:90vhvh;position:absolute;background:var(--overlay);margin-top:10vh;overflow-x:hidden;overflow-y:scroll;padding:25px}
.invisible{opacity:0;visibility:hidden;pointer-events:none;top:100vh}
#spell_overlay{height:200vh}
.spell_lvl:empty{opacity:0;visibility:hidden}
.spell_lvl_head{margin:1em 0 0;font-weight:700;padding:.5em 1em;cursor:pointer;display:inline-flex;width:100%}.spell_lvl_head > p{font-weight:700;margin:0}
.arrow-down{width:8px;height:8px;border-bottom:2px solid;border-left:2px solid;transform:rotate(-45deg);margin:auto}.arrow-up{transform:rotate(135deg)}
.spell_details{background:var(--white);padding:.3em 1em;border-radius:10px}
.backbutton{position:absolute;top:1px;left:1px;width:calc(100% - 2px);height:calc(100% - 2px);z-index:-1}
.spellback{background:var(--overlay)!important}
.sbtnl,.sbtnr{width:80px;height:100%;border-radius:10px;display:inline-flex;background:#f18981}.sbtnr{margin:0 0 0 auto;padding-left:10px}.sbtnl{padding-right:10px}
#all_spells .sbtnl,#all_spells .sbtnr{background:#67d183}
#all_spells .spell_details{background:var(--overlay)}

.dif{display:inline-flex}.db{display:block}.ma{margin:auto}.mo{margin:0}.ms{margin-top:.4em!important}.ha{height:auto}.tc{text-align:center;padding-right:0;padding-left:0}
.w10{width:100%}.w9{width:90%}.w8{width:80%}.w7{width:70%}.w6{width:60%}.w5{width:50%}.w4{width:40%}.w3{width:30%}.w2{width:20%}.w1{width:10%}

/*CSS Icons*/
.trash{color:#424141;margin:auto;width:10px;height:12px;border:2px solid transparent;box-shadow:0 0 0 2px,inset -2px 0 0,inset 2px 0 0;border-bottom-left-radius:1px;border-bottom-right-radius:1px}
.trash::after,.trash::before{content:"";position:absolute;color:currentColor}
.trash::after{background:currentColor;border-radius:3px;width:16px;height:2px;margin:-4px 0 0 -5px}
.trash::before{width:10px;height:4px;border:2px solid;border-bottom:transparent;border-top-left-radius:2px;border-top-right-radius:2px;margin:-8px 0 0 -2px}
.checkmark,.checkmarked{text-indent:10px;height:46px}
.checkmark::before,.checkmarked::before,.checkmarked::after{content:"";display:block}
.checkmark::before,.checkmarked::before{position:absolute;left:9px;width:22px;height:22px;border:2px solid #dbdbdb;border-radius:4px}
.checkmarked::after{width:8px;height:13px;border:1px solid var(--menu);border-width:0 2px 2px 0;transform-origin:bottom left;transform:rotate(45deg) translate(-29.5px,-5px)}
.import{color:#424141;margin:auto;position:relative;display:block;width:18px;height:14px;border:2px solid;border-top:0;box-shadow:-6px -8px 0 -6px,6px -8px 0 -6px}
.import::after,.import::before{content:"";display:block;position:absolute}
.import::before{background:#424141;width:2px;height:14px;right:6px;bottom:5px}
.import::after{width:6px;height:6px;border-right:2px solid;border-bottom:2px solid;right:4px;bottom:4px;transform:rotate(45deg)}
.close{position:relative;display:block;width:22px;height:22px;border:2px solid;border-radius:40px}
.close::after,.close::before{content:"";display:block;position:absolute;width:12px;height:2px;background:currentColor;transform:rotate(45deg);border-radius:5px;top:8px;left:3px}
.close::after{transform:rotate(-45deg)}
#all_spells .details,#all_spells .trash,#char_spells .import{display:none}

@media (min-width:601px) and (max-width:990px){}
@media (min-width:991px){section{width:500px}}
</style>
</head>

<body>
<div id="sections">
 <div class="sec" id="sec_char">
  <div class="row"><div class="container db">
   <div class="input">
    <input id="char" class="drop" type="text" onkeyup="char_list(this);filter(this)" onclick="char_list(this)" autocomplete="false" autocomplete="chrome-off" required>
    <label>Personagem</label>
    <div class="dropdown dn"></div>
   </div>
   <div class="input"><input id="jogador" type="text" onchange="data_add(this)" autocomplete="off" autocomplete="chrome-off" required><label>Jogador</label></div>
   <div class="input"><select id="raça" onchange="data_add(this)" required></select><label>Raça</label></div>
   <div class="input"><select id="origem" onchange="data_add(this)" required></select><label>Origem</label></div>
  </div></div>
  <div class="row"><div class="container">
   <div class="w10 input mo"><select id="classe" onchange="data_add(this);menucolor(this.value)" required></select><label>Classe</label></div>
   <div class="w1"></div>
   <div class="w3 input mo"><select id="nível" class="tc" onchange="data_add(this)" required></select><label class="tc">Nível</label></div>
  </div></div>
  <div class="row"><div class="container db">
   <div class="input"><input id="distincao" onchange="data_add(this)" required><label>Distinção de classe</label></div>
   <div class="input"><div id="divindade" class="fakeinput drop" onclick="show_list(this)" inner="1"></div><label>Divindade</label><div class="dropdown dn"></div></div>
  </div></div>

  <div class="divider"></div>
  <div class="row"><div class="container db">
   <label for="file"><input id="file" type="file" onchange="import_char(event)">Importar</input></label>
   <button onclick="export_char()">Exportar</button>
   <button id="chardel" class="delete" onclick="char_remove()" disabled>Deletar</button>
  </div></div>
 </div>

 <div class="sec" id="sec_combat">
  <div class="row"><div class="container db">
  </div></div>
 </div>

 <div class="sec" id="sec_skill" >
  <div class="row"><div class="container db">
  </div></div>
 </div>

 <div class="sec" id="sec_feat"  >
  <div class="row"><div class="container db">
  </div></div>
 </div>

 <div class="sec" id="sec_spell" >
  <div class="row"><div class="container">
   <div class="w8"><p>Atributo chave</p></div>
   <div class="w3"><select id="spell_hab" class="select tc" onchange="data_add(this)"><option value="3">int</option><option value="4">sab</option><option value="5">car</option></select></div>
  </div></div>
  <div class="row"><div class="container">
   <div class="w8"><p>Teste de resistência</p></div>
   <div class="w3 dif"><div id="res_test"><p>30</p></div></div>
  </div></div>
  <div class="divider"></div>
  <div class="row"><div id="char_spells" class="container db"></div></div>
  <div class="row"><div class="container">
   <button onclick="show('backdrop_spell')">Buscar magias</button>
  </div></div>
 </div>

 <div id="sec_equip" class="sec">
  <div class="row"><div class="container db">
  </div></div>
 </div>

 <div id="sec_condition" class="sec">
  <div class="row"><div class="container db">
  </div></div>
 </div>

 <div id="sec_notes" class="sec">
  <div class="row"><div class="container db">
  </div></div>
 </div>

 <div id="sec_config" class="sec">
  <div class="row"><div class="container db">
   <p>Todos os direitos relativos ao conteúdo Tormenta 20 são reservados à direito da Jambo Editora.</p>
   <p>Esta ferramenta é desenvolvida sem fins lucrativos por Marx, sua finalidade é unicamente recreativa.</p><br>
   <p>Seus dados são armazenados <b>apenas</b> localmente, ou seja, nada é armazenado online. Caso deseje exluir todos os dados, por favor, utilize o botão a seguir. Eles <b>não</b> poderão ser recuperados.</p>
   <button class="delete" onclick="reset()">Excluir todos os dados</button>
  </div></div>
 </div>

</div>

<div id="dice_roller">
 <div id="drawer" onclick="this.parentNode.classList.toggle('drew')"><div></div></div>
  <div id="results"></div>
  <div id="dice-pick"></div>
  <input id="dice" onkeypress="return /[0-9!#d+-kehl]/i.test(event.key)" onchange="diceroll(this.value,1,1);this.value=''"></input>
</div>

<nav>
 <div id="menu">
  <div class="menubtn" onclick="navig(this)"><div class="menubi">
   <div class="menuicon menuselicon"><svg id="icon1" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="presentation" focusable="false"></svg></div>
   <div class="menutext menuseltext">Personagem</div>
  </div></div>
  <div class="menubtn" onclick="navig(this)"><div class="menubi">
   <div class="menuicon"><svg id="icon2" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="presentation" focusable="false" style="transform:translate(14px,13px) scale(-.07)"></svg></div>
   <div class="menutext">Combate</div>
  </div></div>
  <div class="menubtn" onclick="navig(this)"><div class="menubi">
   <div class="menuicon"><svg id="icon3" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="presentation" focusable="false" style="transform:translate(-11px,-13px) scale(.08)"></svg></div>
   <div class="menutext">Perícias</div>
  </div></div>
  <div class="menubtn" onclick="navig(this)"><div class="menubi">
   <div class="menuicon"><svg id="icon4" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="presentation" focusable="false"></svg></div>
   <div class="menutext">Poderes</div>
  </div></div>
  <div class="menubtn" onclick="navig(this)"><div class="menubi">
   <div class="menuicon"><svg id="icon5" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="presentation" focusable="false"></svg></div>
   <div class="menutext">Magias</div>
  </div></div>
  <div class="menubtn" onclick="navig(this)"><div class="menubi">
   <div class="menuicon"><svg id="icon6" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="presentation" focusable="false" style="transform:scale(.074) translate(-195px,-160px)"></svg></div>
   <div class="menutext">Equipamento</div>
  </div></div>
  <div class="menubtn" onclick="navig(this)"><div class="menubi">
   <div class="menuicon"><svg id="icon7" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="presentation" focusable="false" style="fill:none;stroke:currentcolor;stroke-width:2.5"></svg></div>
   <div class="menutext">Condições</div>
  </div></div>
  <div class="menubtn" onclick="navig(this)"><div class="menubi">
   <div class="menuicon"><svg id="icon8" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="presentation" focusable="false" style="transform:scale(.07) translate(-150px,-160px)"></svg></div>
   <div class="menutext">Anotações</div>
  </div></div>
  <div class="menubtn" onclick="navig(this)"><div class="menubi">
   <div class="menuicon"><svg id="icon9" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="presentation" focusable="false" style="transform:scale(.07) translate(-150px,-160px)"></svg></div>
   <div class="menutext">Configurações</div>
  </div></div>
 </div>
</nav>

</div></div>

<div id="backdrop_spell" class="backdrop invisible" onclick="hide(event,this);clear_spell_filters()">
 <div class="overlay">
  <div class="row"><div class="container db">
   <p>Buscar por...</p>
   <div class="input"><input id="spell_name" type="text" onkeyup="filter_spell_name(this)" autocomplete="off" autocomplete="chrome-off" required><label>Nome da magia</label></div>
   <div class="input"><div id="spell_level" class="fakeinput drop" onclick="show_list(this)" tabindex="1"></div><label>Nível</label><div class="dropdown dn"></div></div>
   <div class="input"><div id="spell_class" class="fakeinput drop" onclick="show_list(this)" tabindex="2"></div><label>Classificação</label><div class="dropdown dn"></div></div>
   <div class="input"><div id="spell_school" class="fakeinput drop" onclick="show_list(this)" tabindex="3"></div><label>Escola</label><div class="dropdown dn"></div></div>   
  </div></div>
  <div class="row"><div id="all_spells" class="container db"></div></div>
 </div>
</div>

</body>

<script>
const load = 1;var title = '';var chars = [];var data = {};



//-------------------------SPELLS FUNCTIONS------------------------//

var filt_spells = [];
var spell_viz = [];
function list_spells(e){
 e = document.getElementById(e);
 e.innerHTML = '';
 for (var lvl in spells){
  var div = document.createElement('div');
  div.setAttribute('id','spell_lvl_'+lvl);
  div.classList.add('spell_lvl');
  div.setAttribute('onclick','show_spells(this,event)');
  div.innerHTML = '<div class="spell_lvl_head"><p class="w9">Magias de '+lvl+'&deg; nível</p><div class="arrow-down"></div></div>';
  e.appendChild(div);
  var div = document.createElement('div');
  div.classList.add('hid');
  e.children[lvl-1].appendChild(div);
  for (var name in spells[lvl]){
   var div = document.createElement('div');
   div.setAttribute('class','spell w10 h70');
   div.setAttribute('spell',spells[lvl][name]["nome"]);
   div.setAttribute('level',spells[lvl][name]["circulo"]);
   div.setAttribute('cat',spells[lvl][name]["tipo"]);
   div.setAttribute('school',spells[lvl][name]["escola"]);
   div.setAttribute('translate','0');
   div.setAttribute('written','0');
   div.setAttribute('onclick','spell_info(this,event)');
   var content = '<div class="spell_details" ontouchstart="spell_touch_start(event)" ontouchend="spell_touch_end(event);spell_deltaX(this,event)"><div class="w10 dif"><div class="w9"><p class="item_title">'+spells[lvl][name]["nome"]+'</p><p class="item_subtitle">'+spell_pm_cost[lvl-1]+' PM · '+spells[lvl][name]["tipo"]+' · '+spells[lvl][name]["escola"]+' '+spells[lvl][name]["circulo"]+'</p></div><div class="item_action w1 ma">';
   if(spell_action.includes(spells[lvl][name]["execucao"])){content += '<div class="ac_'+spells[lvl][name]["execucao"]+'"></div>'}
   content += '</div></div><div class="item_subtitle w10 hid ms">';
   if(!spell_action.includes(spells[lvl][name]["execucao"])){content += '<p class="nowrap"><b>Execução:</b> '+spells[lvl][name]["execucao"]+'</p>'}

   if(spells[lvl][name]["alcance"]){content += '<p class="nowrap"><b>Alcance:</b> '+spells[lvl][name]["alcance"]+'</p>'}
   if(spells[lvl][name]["alvo"]){content += '<p class="nowrap"><b>Alvo:</b> '+spells[lvl][name]["alvo"]+'</p>'}
   if(spells[lvl][name]["area"]){content += '<p class="nowrap"><b>Área:</b> '+spells[lvl][name]["area"]+'</p>'}
   if(spells[lvl][name]["duracao"]){content += '<p class="nowrap"><b>Duração:</b> '+spells[lvl][name]["duracao"]+'</p>'}
   if(spells[lvl][name]["resistencia"]){content += '<p class="nowrap"><b>Resistência:</b> '+spells[lvl][name]["resistencia"]+'</p>'}
   content += '<p class="nowrap ms">'+spells[lvl][name]["descricao"]+'</p>';
   var length = (Object.keys(spells[lvl][name]).length - 11)/2;
   for (var i=1;i<=length;i++){
    content += '<p class="nowrap ms"><b class="w2">';
    content += Number.isInteger(spells[lvl][name]["add"+i])?('+'+spells[lvl][name]["add"+i]+' PM'):spells[lvl][name]["add"+i];
    content += ': </b><span class="w8">'+spells[lvl][name]["mod"+i]+'</span></p>';
   }
   content += '</div></div><div class="backbutton container"><div class="sbtnl" onclick="add_spell(this)"><div class="import"></div><div class="trash"></div></div><div class="sbtnr" onclick="add_spell(this)"><div class="import"></div><div class="trash"></div></div></div>';
   div.innerHTML = content;
   e.children[lvl-1].children[1].appendChild(div);
  }
 }
 filt_spells = document.getElementById('all_spells').getElementsByClassName('spell');
 for (var i=0;i<filt_spells.length;i++){spell_viz.push([1,1,1,1])}
}

function filter_spells(){
 for (var i=0;i<filt_spells.length;i++){
  if(spell_viz[i][0]&&spell_viz[i][1]&&spell_viz[i][2]&&spell_viz[i][3]){filt_spells[i].style.display=""}
  else{filt_spells[i].style.display="none"}
 }
}

const stats = ['level','cat','school'];
function filter_spell_other(e){
 var k = e.getAttribute('tabindex');
 var filter = e.innerHTML;
 if(!filter){filter=JSON.stringify(spell_inputs[k-1])}
 for (var i=0;i<filt_spells.length;i++){
  var stat = filt_spells[i].getAttribute(stats[k-1]);
  if(filter.indexOf(stat)>-1){spell_viz[i][k]=1}
  else{spell_viz[i][k]=0}
 }
 filter_spells();
}

function filter_spell_name(el){
 var filter = el.value.toUpperCase();
 for (var i=0;i<filt_spells.length;i++){
  var spellname = filt_spells[i].getAttribute('spell').toUpperCase();
  if(spellname.indexOf(filter)>-1){spell_viz[i][0]=1}
  else{spell_viz[i][0]=0}
 }
 filter_spells();
}

function add_spell(e){
 e = e.parentNode.parentNode;
 var written = JSON.parse(e.getAttribute('written'));
 if(written){e.remove()}
 else{
  e.setAttribute('translate','0');
  e.style.transform = 'translateX(0)';
  e.children[1].style.transform = 'translateX(0)';
  e = e.cloneNode(true);
  document.getElementById('char_spells').appendChild(e);
  e.setAttribute('written','1');
 }
}

function clear_spell_filters(){
 var e = document.getElementById('spell_name');e.value='';filter_spell_name(e);
 e = document.getElementById('spell_level');e.innerHTML='';filter_spell_other(e);
 e = document.getElementById('spell_class');e.innerHTML='';filter_spell_other(e);
 e = document.getElementById('spell_school');e.innerHTML='';filter_spell_other(e);
 e = document.getElementsByClassName('spell_lvl');
 for (var i=0;i<e.length;i++){
  e[i].children[0].children[1].classList.remove('arrow-up');
  e[i].children[1].classList.add('hid');
  e[i].children[1].style = '';
 }
}

function spell_deltaX(e,ev){
 var deltaX = touchendX-touchstartX;
 if(e==ev.target||e.contains(ev.target)){
  e = e.parentNode;
  var trans = JSON.parse(e.getAttribute('translate'));
  trans += Math.sign(deltaX)*70;
  if(trans>70){trans=70}if(trans<-70){trans=-70}
  e.style.transform = 'translateX('+trans+'px)';
  e.children[1].style.transform = 'translateX('+-trans+'px)'
  e.setAttribute('translate',trans);
 }
}
function spell_touch_start(e){touchstartX=e.changedTouches[0].screenX}
function spell_touch_end(e){touchendX=e.changedTouches[0].screenX}

function show_spells(e,ev){
 if(e==ev.target||e.children[0].contains(ev.target)){
  e.children[0].children[1].classList.toggle('arrow-up');
  e = e.children[1];
  e.classList.toggle('hid');
  e.style.maxHeight = e.style.maxHeight?null:e.scrollHeight+"px";
 }
}

function spell_info(e,ev){
 if(e==ev.target||e.children[0].contains(ev.target)){
  e.classList.toggle('more_info');
  e = e.children[0].children[1];
  e.classList.toggle('hid');
  e.style.maxHeight = e.style.maxHeight?null:e.scrollHeight+"px";
 }
}



//-------------------------NAVIGATION FUNCTIONS------------------------//

var x = 0;
let touchstartX = 0;
let touchendX = 0;
const menubtn = document.getElementsByClassName('menubtn');

function navig(e){
 e.parentNode.children[x].children[0].children[0].classList.remove('menuselicon');
 e.parentNode.children[x].children[0].children[1].classList.remove('menuseltext');
 e.children[0].children[0].classList.add('menuselicon');
 e.children[0].children[1].classList.add('menuseltext');
 x = Array.prototype.indexOf.call(e.parentNode.children,e);
 const sections = document.getElementById('sections');
 sections.style.transform='translate(-'+x*100+'vw,0)';
 window.scrollTo({top:0,behavior:'smooth'});
}

function deltaX(){
 var deltaX = touchstartX-touchendX;
 if(deltaX>200&&x<8){navig(menubtn[x+1])}
 if(deltaX<-200&&x>0){navig(menubtn[x-1])}
}
document.getElementById('sections').addEventListener('touchstart',e=>{touchstartX=e.changedTouches[0].screenX})
document.getElementById('sections').addEventListener('touchend',e=>{touchendX=e.changedTouches[0].screenX;deltaX()})

function amIclicked(e,el){
 e = e || event;
 var target = e.target || e.srcElement;
 if(target.id==el.id){return true}
 else{return false}
}
function hide(e,el){if(amIclicked(e,el)){el.classList.toggle('invisible')}}
function show(el){document.getElementById(el).classList.toggle('invisible')}

function menucolor(i){
 document.querySelector('meta[name="theme-color"]').setAttribute('content',colors[i]);
 document.querySelector(':root').style.setProperty('--menu',colors[i]);
}

function filter(el){
 var filter = el.value.toUpperCase();
 var a = el.parentNode.children[2].getElementsByTagName("a");
 for (var i=1;i<a.length;i++){
  txtValue = a[i].textContent || a[i].innerText;
  if(txtValue.toUpperCase().indexOf(filter)>-1){a[i].style.display=""}
  else{a[i].style.display="none"}
 }
}

function show_list(e){
 e.focus();
 e = e.parentNode.children[2].classList.remove('dn');
}

var cspell_level=[],cspell_class=[],cspell_school=[],cdivindade=[];
function set_check(e,array){
 e.classList.toggle('checkmarked');
 e.value=!e.value;
 if(e.value){array.push(e.innerHTML)}else{array.splice(array.indexOf(e.innerHTML),1)}
 array.sort();
 e = e.parentNode.parentNode.children[0];
 e.innerHTML = array.join(', ');
 if(e.getAttribute('inner')){data_inner(e)}
 else{filter_spell_other(e)}
}

window.addEventListener('click',function(e){
 var el = document.getElementsByClassName('dropdown');
 for (i=0;i<el.length;i++){
  if(!el[i].parentNode.contains(e.target)){el[i].parentNode.children[2].classList.add("dn")}
 }
 window.focus();
});



//-------------------------STARTER FUNCTIONS------------------------//

function set_select(array){
 for (j=0;j<array.length;j++){
  var div = document.createElement('option');
  if(j){div.setAttribute('value',j);div.innerHTML = array[j]}
  else{div.setAttribute('disabled','');div.setAttribute('selected','')}
  document.getElementById(array[0]).appendChild(div);
 }
}

function set_checkbox(array){
 for(var j=1;j<array.length;j++){document.getElementById(array[0]).parentNode.children[2].innerHTML += '<a class="checkmark" onclick="set_check(this,c'+array[0]+')">'+array[j]+'</a>'}
}

function start_up(){
 for (var key in icons){document.getElementById(key).innerHTML = icons[key]}
 for (var i=0;i<inputs.length;i++){set_select(inputs[i])}
 set_checkbox(divindade);
 for (var i=0;i<spell_inputs.length;i++){set_checkbox(spell_inputs[i])}
 list_spells('all_spells');
}
	


//-------------------------CHARACTERS FUNCTIONS------------------------//

function char_add(e){
 title = e.title;
 if(title){
  data={};
  data[e.name]=title;
  chars.push(title);
  document.title = title + ' - T20';
  document.getElementById('chardel').disabled = false;
  clear();
  document.getElementById(e.name).value=title;
  console.log('Character '+title+' was created');
 }
}

function char_list(el){
 var value = el.value;
 console.log('value = '+value);
 el = el.parentNode.children[2];
 if(value||chars.length){el.classList.remove('dn')}
 if(!value&&!chars.length){el.classList.add('dn')}
 el.innerHTML = '';
 if(value){el.innerHTML = '<a name="char" onclick="char_add(this)" title="'+value+'">Criar personagem '+value+'?</a>'}
 if(chars.length){for(var i=0;i<chars.length;i++){el.innerHTML += '<a onclick="char_set(this)">'+chars[i]+'</a>'}}
}

function char_set(el){
 if(title){save_data()}
 clear();
 title = el.innerHTML;
 data_load();
 document.title = title + ' - T20';
 document.getElementById('chardel').disabled = false;
 data_set();
 console.log('Character '+title+' was loaded');
}

function char_remove(){
 if(title){
  console.log('Character '+title+' was removed');
  chars.splice(chars.indexOf(title),1);
  localStorage.removeItem(title+'_data');
  clear();title='';data={};
  document.title = 'Ficha T20 Mobile - v0.5';
  document.getElementById('chardel').disabled = true;
 }
}



//-------------------------DATA MANAGEMENT FUNCTIONS------------------------//

function data_add(e){data[e.id]=e.value}
function data_inner(e){data[e.id]=e.innerHTML}

window.addEventListener('beforeunload',save_data);
function save_data(){
 localStorage.setItem('chars',JSON.stringify(chars));
 if(title){
  localStorage.setItem(title+'_data',JSON.stringify(data));
  console.log('Character '+title+' data saved');
 }
}
window.onload = function(){
 start_up();
 if(load&&localStorage.getItem('chars')){chars = JSON.parse(localStorage.getItem('chars'))}
}

function data_set(){
 for (const key in data){
  var e=document.getElementById(key);
  if(e.getAttribute('inner')){e.innerHTML=data[key]}
  else{e.value=data[key]}
 }
 title=data['char'];
 document.title = title + ' - T20';
 document.getElementById('chardel').disabled = false;
}

function data_load(){
 if(load&&localStorage.getItem(title+'_data')){data = JSON.parse(localStorage.getItem(title+'_data'))}
}

function clear(){
 var input = document.getElementsByTagName("input");
 for (var i=0;i<input.length;i++){input[i].value=''}
 var select = document.getElementsByTagName("select");
 for (var i=0;i<select.length;i++){
  option = select[i].options;
  option[0].selected = true;
 }
 var fakeinput = document.getElementsByClassName('fakeinput');
 for (var i=0;i<fakeinput.length;i++){fakeinput[i].innerHTML=''}
}

function import_char(evt){
 data = {};
 if(!window.FileReader) return; // Browser is not compatible
 var reader = new FileReader();
  reader.onload = function(evt) {
   if(evt.target.readyState!=2) return;
   if(evt.target.error){alert('Error while reading file');return}
   data = JSON.parse(evt.target.result);
   chars.push(data['char']);
   data_set();
   console.log('Character '+data['char']+' data imported');
  };
 reader.readAsText(evt.target.files[0]);
}

function export_char(){
 var filename = title?'char_'+title:'unnamed_char' +'.txt';
 var filedata = JSON.stringify(data);
 var file = new Blob([filedata], {type:'text/plain'});
 if (window.navigator.msSaveOrOpenBlob) // IE10+
     window.navigator.msSaveOrOpenBlob(file, filename);
 else{
  var a = document.createElement("a"),url = URL.createObjectURL(file);
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  setTimeout(function() {
   document.body.removeChild(a);
   window.URL.revokeObjectURL(url);  
  }, 0); 
 }
 console.log('Character '+title+' data exported');
}

function reset(){
 localStorage.clear();
 chars=[];
 data={};
 title='';
 location.reload();
}

show('backdrop_spell');
</script>
</html>