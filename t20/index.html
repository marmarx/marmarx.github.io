<!DOCTYPE html>
<html>
<head>
<title>Ficha T20 Mobile (v1)</title>
<meta name="author" content="Marco Martins">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#FF385C">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Lora:wght@500;600&family=Open+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<script type="text/javascript" src="db/skills.txt"></script>
<script type="text/javascript" src="db/conditions.txt"></script>
<script type="text/javascript" src="db/spells.txt"></script>
<script type="text/javascript" src="db/geral.txt"></script>

<style>
:root{--pv:#FF4466;--pm:#4BC7CF;--menu:#FF385C;--drawer:#dbdbdb;--diceroller:#e9e9e9}
*,*:before,*:after{margin:0;padding:0;transition:all .7s ease-in-out;font-family:'Open Sans', sans-serif;color:#292929;word-wrap:normal;word-break:keep-all;box-sizing:border-box}
html,body{overflow-x:hidden;width:100vw;min-height:100vh}
::-webkit-scrollbar{width:0}

.row{display:inline-flex;position:relative;width:100%}
.container{margin:auto;width:80%;display:inline-flex}
.half,.third{float:left;width:100%}
@media (min-width:991px){.half{width:49.99999%}.third{width:33.33333%}}

h1,h2{text-align:center;margin:.5em 0;letter-spacing:4px;font-family:'Lora', serif;color:#fff;text-shadow:2px 2px 3px #252525,2px 2px 5px #252525}
h1{font-size:3.6em;font-weight:500}h2{font-size:1.8em;text-transform:uppercase;font-weight:600}
h3,h4,p,li{line-height:1.8em;letter-spacing:.8px;text-align:justify}
h3{font-size:2em}h4{font-size:1.4em}h3,h4{font-weight:400;margin-top:1.5em}
p,li{font-size:1.2em;font-weight:300;margin:.5em 0}
ul{margin:2em}b,.bold{font-weight:bold}i,.italic{font-style:italic}

#sections{width:800vw;position:relative}
.sec{width:100vw;float:left;padding:25px 25px 125px 25px}
#dice_roller,#drawer{border-top-left-radius:25px;border-top-right-radius:25px}
#dice_roller{position:fixed;width:100vw;height:105px;background:var(--diceroller);bottom:0}
#drawer{width:100vw;height:35px;padding:15px 35%;background:var(--drawer)}.drew{height:90vh!important}
#drawer div{width:100%;height:100%;background:#fff;border-radius:5px}
#dice{position:absolute;padding:0 25px;width:100%;bottom:0}

nav{position:fixed;left:0;bottom:0;height:70px;width:100vw;background:#fff;border-top:1px solid #EBEBEB;overflow:scroll}
#menu{display:inline-flex}
.menubtn{width:20vw;height:70px;float:left;display:inline-flex}.menubi{margin:auto}
.menuicon{color:#b0b0b0;width:fit-content;margin:auto}
.menuicon svg{display:block;height:24px;width:24px;overflow:visible;fill:currentcolor}
.menuicon path{color:#b0b0b0}.menuselicon path{color:var(--menu)}
.menutext{font-size:.625em;font-weight:600;color:#717171;margin-top:.2em}.menuseltext{font-weight:700}

#res_test{margin:auto}#spells_list{display:block}
.spell{padding:.5em 1em;border:1px solid transparent;border-radius:10px;margin:.5em 0}
.more_info{border-color:rgba(32,32,32,.4)}
.item_title,.item_subtitle{margin:0}.item_title{font-size:1em;font-weight:500;display:inline-flex}.item_subtitle{font-size:.8em;max-height:0}
.item_action{margin-right:0}p.item_subtitle{max-height:unset}
.hid{visibility:hidden;opacity:0;margin:0}
.nowrap{word-break:break-all;margin:0;font-size:1em}

.ac_free,.ac_mov,.ac_pad,.ac_comp,.ac_pad:before,.ac_comp:before,.ac_comp:after{width:12px;height:12px;border:1px solid #e8e8e8;display:block}
.ac_free,.ac_mov,.ac_pad,.ac_comp{transform:rotate(45deg)}
.ac_free{border:1px solid #b3b2b2}
.ac_mov,.ac_pad,.ac_comp,.ac_pad:before,.ac_comp:before,.ac_comp:after{background:#b3b2b2}
.ac_pad:before,.ac_comp:before,.ac_comp:after{content:''}.ac_pad:before,.ac_comp:before{transform:translate(4px,-6px)}.ac_comp:after{transform:translate(9px,-23px)}
.ac_reac{width:14px;height:14px;border:2px solid;border-right-color:transparent;border-radius:100px;transform:rotate(135deg)}.ac_reac:before{content:"";position:absolute;width:6px;height:6px;border-top:2px solid;border-right:2px solid;top:-3px;right:-1px;transform:rotate(68deg)}.ac_reac,.ac_reac:before{color:#b3b2b2}
.trash{width:10px;height:12px;border:2px solid transparent;box-shadow:0 0 0 2px,inset -2px 0 0,inset 2px 0 0;border-bottom-left-radius:1px;border-bottom-right-radius:1px;margin-top:4px;color:currentColor;position:absolute;top:calc(50% - 9px);right:25%}
.trash::after,.trash::before{content:"";position:absolute;color:currentColor}
.trash::after{background:currentColor;border-radius:3px;width:16px;height:2px;top:-4px;left:-5px}
.trash::before{width:10px;height:4px;border:2px solid;border-bottom:transparent;border-top-left-radius:2px;border-top-right-radius:2px;top:-7px;left:-2px}
.divider{width:70%;height:2px;margin:1em auto;background:rgba(32,32,32,.2)}

.input{position:relative}
input,select{border:1px solid #b0b0b0;border-radius:5px;font-size:1.1em;line-height:1.2em;-webkit-appearance:none;padding:1.6em 1.3em .5em;background:#fff}
input,select,label{margin:.6em 0;width:100%}
label{position:absolute;left:0;pointer-events:none;color:#717171;padding:1.3em 1.6em}
input:focus ~ label,input:not(:focus):valid ~ label,select:focus ~ label,select:not(:focus):valid ~ label{font-size:.7em;padding:.4em 2.1em;margin:1.1em 0;left:2px}
.select{padding:.8em;margin:0}
input[type="file"]{display:none}
label[for="file"]{position:relative;pointer-events:all}

.backdrop,.call_action{width:100vw;left:0;top:0}
.backdrop{height:100vh;position:fixed;top:0;background:hsl(0 0% 10%/.5);backdrop-filter:blur(2px)}
.call_action{height:85vh;position:absolute;background:#e8e8e8}
.invisible{top:100vh}
button,label[for="file"]{padding:14px 26px;text-align:center;text-decoration:none;display:inline-block;font-size:100%;margin:10px 0;cursor:pointer;border-radius:5px; width:100%;background:transparent;border:2px solid #292929;color:#292929;font-weight:600}
button:hover,button:focus,label[for="file"]:hover,label[for="file"]:focus{background:#292929;color:#e8e8e8}
button.delete{border:2px solid #ef5d5d;color:#ef5d5d}button.delete:hover{background:#ef5d5d;color:#fff}
button:disabled,button:hover:disabled{border:2px solid #b0b0b0;color:#b0b0b0;background:#fff;cursor:no-drop}

a{color:black;padding:12px 30px;text-decoration:none;display:block}
a:hover{background-color:#1e90ff;color:#fff}
.dropdown{position:absolute;background-color:#fff;border:1px solid #000;z-index:1;width:100%;top:71px;max-height:250px;overflow-y:scroll}
.dn{display:none!important;border:0}

.dif{display:inline-flex}.db{display:block}.ma{margin:auto}.mo{margin:0}.ms{margin-top:.4em!important}.ha{height:auto}.tc{text-align:center;padding-right:0;padding-left:0}
.w10{width:100%}.w9{width:90%}.w8{width:80%}.w7{width:70%}.w6{width:60%}.w5{width:50%}.w4{width:40%}.w3{width:30%}.w2{width:20%}.w1{width:10%}

@media (min-width:601px) and (max-width:990px){}
@media (min-width:991px){section{width:500px}}
</style>
</head>

<body>
<div id="sections">
 <div class="sec" id="sec_char">
  <div class="row"><div class="container db">
   <div class="input">
    <input id="char" class="drop" type="text" onkeyup="char_list(this);filter(this)" onclick="char_list(this)" autocomplete="false" autocomplete="chrome-off" required>
    <label>Personagem</label>
    <div id="name-dropdown" class="dropdown dn"></div>
   </div>
   <div class="input"><input id="jogador" type="text" onchange="data_add(this)" autocomplete="off" autocomplete="chrome-off" required><label>Jogador</label></div>
   <div class="input"><select id="raça" onchange="data_add(this)" required></select><label>Raça</label></div>
   <div class="input"><select id="origem" onchange="data_add(this)" required></select><label>Origem</label></div>
  </div></div>
  <div class="row"><div class="container">
   <div class="w10 input"><select id="classe" onchange="data_add(this);menucolor(this.value)" required></select><label>Classe</label></div>
   <div class="w1"></div>
   <div class="w3 input"><select id="nível" class="tc" onchange="data_add(this)" required></select><label class="tc">Nível</label></div>
  </div></div>
  <div class="row"><div class="container db">
   <div class="input"><select id="divindade" onchange="data_add(this)" required></select><label>Divindade</label></div>
  </div></div>
  <div class="divider"></div>
  <div class="row"><div class="container db">
   <label for="file"><input id="file" type="file" onchange="import_char(event)">Importar</input></label>
   <button onclick="export_char()">Exportar</button>
   <button id="chardel" class="delete" onclick="char_remove()" disabled>Deletar</button>
  </div></div>
 </div>
 <div class="sec" id="sec_combat"></div>
 <div class="sec" id="sec_skill" ></div>
 <div class="sec" id="sec_feat"  ></div>
 <div class="sec" id="sec_spell" >
  <div class="row"><div class="container">
   <div class="w8"><p>Atributo chave</p></div>
   <div class="w3"><select id="shab" class="select tc" onchange=""><option value="3">int</option><option value="4">sab</option><option value="5">car</option></select></div>
  </div></div>
  <div class="row"><div class="container">
   <div class="w8"><p>Teste de resistência</p></div>
   <div class="w3 dif"><div id="res_test"><p>30</p></div></div>
  </div></div>
  <div class="divider"></div>
  <div class="row"><div id="spells_list" class="container">

   <div class="spell w10 h70" onclick="moreinfo(this)">
    <div class="w10 dif">
     <div class="w9">
      <p class="item_title">Curar Ferimentos Leves</p>
      <p class="item_subtitle">3 PM · Divina · Conjuração 1 · Clérigo 1</p>
     </div><div class="item_action w1 ma"><div class="ac_reac"></div></div>
    </div>
    <div class="item_subtitle w10 hid ms">
     <p class="nowrap"><b>Alcance:</b> Toque</p>
     <p class="nowrap"><b>Alvo:</b> 1 criatura</p>
     <p class="nowrap"><b>Duração:</b> Instantânea</p>
     <p class="nowrap"><b>Resistência:</b> Nenhuma</p>
     <p class="nowrap ms">Ao tocar cure 1d8+1 PV do alvo, remove uma doença ou outra condição negativa</p>
     <p class="nowrap ms"><b class="w2">+1 PM: </b><span class="w8">Ao tocar cure 1d8+1 PV do alvo, remove uma doença ou outra condição negativa</span></p>
    </div>
   </div>

   <div class="spell w10 h70" onclick="moreinfo(this)">
    <div class="w10 dif">
     <div class="w9">
      <p class="item_title">Curar Ferimentos Leves</p>
      <p class="item_subtitle">3 PM · Divina · Conjuração 1 · Clérigo 1</p>
     </div><div class="item_action w1 ma"><div class="ac_reac"></div></div>
    </div>
    <div class="item_subtitle w10 hid ms">
     <p class="nowrap"><b>Alcance:</b> Toque</p>
     <p class="nowrap"><b>Alvo:</b> 1 criatura</p>
     <p class="nowrap"><b>Duração:</b> Instantânea</p>
     <p class="nowrap"><b>Resistência:</b> Nenhuma</p>
     <p class="nowrap ms">Ao tocar cure 1d8+1 PV do alvo, remove uma doença ou outra condição negativa</p>
     <p class="nowrap ms"><b class="w2">+1 PM: </b><span class="w8">Ao tocar cure 1d8+1 PV do alvo, remove uma doença ou outra condição negativa</span></p>
    </div>
   </div>

  </div></div>
  <div class="row"><div class="container">
   <button onclick="show('spell_overlay')">Buscar magias</button>
  </div></div>
 </div>
 <div id="sec_equip" class="sec"></div>
 <div id="sec_condition" class="sec"></div>
 <div id="sec_notes" class="sec"></div>
</div>
<div id="dice_roller">
 <div id="drawer" onclick="this.parentNode.classList.toggle('drew')"><div></div></div>
 <div id="dice"></div>
</div>
<nav>
 <div id="menu">
  <div class="menubtn" onclick="navig(this)"><div class="menubi">
   <div class="menuicon menuselicon"><svg id="icon1" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="presentation" focusable="false"></svg></div>
   <div class="menutext menuseltext">Personagem</div>
  </div></div>
  <div class="menubtn" onclick="navig(this)"><div class="menubi">
   <div class="menuicon"><svg id="icon2" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="presentation" focusable="false" style="transform:translate(14px,13px) scale(-.07)"></svg></div>
   <div class="menutext">Combate</div>
  </div></div>
  <div class="menubtn" onclick="navig(this)"><div class="menubi">
   <div class="menuicon"><svg id="icon3" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="presentation" focusable="false" style="transform:translate(-11px,-13px) scale(.08)"></svg></div>
   <div class="menutext">Perícias</div>
  </div></div>
  <div class="menubtn" onclick="navig(this)"><div class="menubi">
   <div class="menuicon"><svg id="icon4" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="presentation" focusable="false"></svg></div>
   <div class="menutext">Poderes</div>
  </div></div>
  <div class="menubtn" onclick="navig(this)"><div class="menubi">
   <div class="menuicon"><svg id="icon5" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="presentation" focusable="false"></svg></div>
   <div class="menutext">Magias</div>
  </div></div>
  <div class="menubtn" onclick="navig(this)"><div class="menubi">
   <div class="menuicon"><svg id="icon6" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="presentation" focusable="false" style="transform:scale(.074) translate(-195px,-160px)"></svg></div>
   <div class="menutext">Equipamento</div>
  </div></div>
  <div class="menubtn" onclick="navig(this)"><div class="menubi">
   <div class="menuicon"><svg id="icon7" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="presentation" focusable="false" style="fill:none;stroke:currentcolor;stroke-width:2.5"></svg></div>
   <div class="menutext">Condições</div>
  </div></div>
  <div class="menubtn" onclick="navig(this)"><div class="menubi">
   <div class="menuicon"><svg id="icon8" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="presentation" focusable="false" style="transform:scale(.07) translate(-150px,-160px)"></svg></div>
   <div class="menutext">Anotações</div>
  </div></div>
 </div>
</nav>

</div></div>

</body>

<script>
const load = 1;var title = '';var chars = [];var data = {};


//-------------------------NAVIGATION FUNCTIONS------------------------//

var x = 0;
function navig(e){
 e.parentNode.children[x].children[0].children[0].classList.remove('menuselicon');
 e.parentNode.children[x].children[0].children[1].classList.remove('menuseltext');
 e.children[0].children[0].classList.add('menuselicon');
 e.children[0].children[1].classList.add('menuseltext');
 x = Array.prototype.indexOf.call(e.parentNode.children,e);
 const sections = document.getElementById('sections');
 sections.style.transform='translate(-'+x*100+'vw,0)';
 sections.scrollTo({top:0,behavior:'smooth'});
}

function moreinfo(e){
 e.classList.toggle('more_info');
 e = e.children[1];
 e.classList.toggle('hid');
 e.style.maxHeight = e.style.maxHeight?null:e.scrollHeight+"px";
}

function amIclicked(e,el){
 e = e || event;
 var target = e.target || e.srcElement;
 if(target.id==el.id){return true}
 else{return false}
}
function hide(e,el){if(amIclicked(e,el)){el.classList.toggle('invisible')}}
function show(el){document.getElementById(el).classList.toggle('invisible')}

function menucolor(i){
 console.log(i);
 document.querySelector('meta[name="theme-color"]').setAttribute('content',colors[i]);
 document.querySelector(':root').style.setProperty('--menu',colors[i]);
}

function filter(el){
 var filter = el.value.toUpperCase();
 var a = el.parentNode.children[2].getElementsByTagName("a");
 for (var i=1;i<a.length;i++){
  txtValue = a[i].textContent || a[i].innerText;
  if(txtValue.toUpperCase().indexOf(filter)>-1){a[i].style.display=""}
  else{a[i].style.display="none"}
 }
}

window.addEventListener('click',function(e){
 var el = document.getElementsByClassName('drop');
 for (i=0;i<el.length;i++){if(el[i].contains(e.target)){}else{el[i].parentNode.children[2].classList.add("dn")}}
});


//-------------------------STARTER FUNCTIONS------------------------//

function set_select(array){
 for (j=0;j<array.length;j++){
  var div = document.createElement('option');
  if(j){div.setAttribute('value',j);div.innerHTML = array[j]}
  else{div.setAttribute('disabled','');div.setAttribute('selected','')}
  document.getElementById(array[0]).appendChild(div);
 }
}

function start_up(){
 for (var key in icons){document.getElementById(key).innerHTML = icons[key]}
 for (var i=0;i<inputs.length;i++){set_select(inputs[i])}
}

	


//-------------------------CHARACTERS FUNCTIONS------------------------//

function char_add(e){
 title = e.title;
 if(title){
  data={};
  data[e.name]=title;
  chars.push(title);
  document.title = title + ' - T20';
  document.getElementById('chardel').disabled = false;
  clear();
  document.getElementById(e.name).value=title;
  console.log('Character '+title+' was created');
 }
}

function char_list(el){
 var value = el.value;
 console.log('value = '+value);
 el = el.parentNode.children[2];
 if(value||chars.length){el.classList.remove('dn')}
 if(!value&&!chars.length){el.classList.add('dn')}
 el.innerHTML = '';
 if(value){el.innerHTML = '<a name="char" onclick="char_add(this)" title="'+value+'">Criar personagem '+value+'?</a>'}
 if(chars.length){for(var i=0;i<chars.length;i++){el.innerHTML += '<a onclick="char_set(this)">'+chars[i]+'</a>'}}
}

function char_set(el){
 if(title){save_data()}console.log(title);
 clear();
 title = el.innerHTML;console.log(title);
 data_load();
 clear();
 document.title = title + ' - T20';
 document.getElementById('chardel').disabled = false;
 data_set();
 console.log('Character '+title+' was loaded');
}

function char_remove(){
 if(title){
  console.log('Character '+title+' was removed');
  chars.splice(chars.indexOf(title),1);
  localStorage.removeItem(title+'_data');
  clear();title='';data={};
  document.title = 'Ficha T20 Mobile (v1)';
  document.getElementById('chardel').disabled = true;
 }
}



//-------------------------DATA MANAGEMENT FUNCTIONS------------------------//

function data_add(e){data[e.id]=e.value}

window.addEventListener('beforeunload',save_data);
function save_data(){
 localStorage.setItem('chars',JSON.stringify(chars));
 if(title){
  localStorage.setItem(title+'_data',JSON.stringify(data));
  console.log('Character '+title+' data saved');
 }
}
window.onload = function(){
 start_up();
 if(load&&localStorage.getItem('chars')){chars = JSON.parse(localStorage.getItem('chars'))}
}

function data_set(){
 for (const key in data){document.getElementById(key).value=data[key]}
 title=data['char'];
 document.title = title + ' - T20';
 document.getElementById('chardel').disabled = false;
}

function data_load(){
 if(load&&localStorage.getItem(title+'_data')){data = JSON.parse(localStorage.getItem(title+'_data'))}
}

function clear(){
 var input = document.getElementsByTagName("input");
 for (var i=0;i<input.length;i++){input[i].value=''}
 var select = document.getElementsByTagName("select");
 for (var i=0;i<select.length;i++){
  option = select[i].options;
  option[0].selected = true;
 }
}

function import_char(evt){
 data = {};
 if(!window.FileReader) return; // Browser is not compatible
 var reader = new FileReader();
  reader.onload = function(evt) {
   if(evt.target.readyState!=2) return;
   if(evt.target.error){alert('Error while reading file');return}
   data = JSON.parse(evt.target.result);
   chars.push(data['char']);
   data_set();
   console.log('Character '+data['char']+' data imported');
  };
 reader.readAsText(evt.target.files[0]);
}

function export_char(){
 var filename = title?'char_'+title:'unnamed_char' +'.txt';
 var filedata = JSON.stringify(data);
 var file = new Blob([filedata], {type:'text/plain'});
 if (window.navigator.msSaveOrOpenBlob) // IE10+
     window.navigator.msSaveOrOpenBlob(file, filename);
 else { // Others
  var a = document.createElement("a"),url = URL.createObjectURL(file);
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  setTimeout(function() {
   document.body.removeChild(a);
   window.URL.revokeObjectURL(url);  
  }, 0); 
 }
 console.log('Character '+title+' data exported');
}

function reset(){
 localStorage.clear();
 chars=[];
 data={};
 title='';
 location.reload();
}
reset();
</script>
</html>