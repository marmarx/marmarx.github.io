<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="author" content="Marco Martins">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Controle de Portões</title>
<style>
  body { font-family: Arial; padding: 20px }
  #gates {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 10px;
  }
  .gate {
    border: 1px solid #ccc;
    padding: 12px;
    border-radius: 6px;
    background-position: 0 0;
    background-size: 200% 100%;
    background-image: linear-gradient(
      to right, #ff6347 0%, #ff6347 50%, #4682b4 50%, #4682b4 100%
    );
  }

  .open { animation: slideBg 2s linear forwards; }
  .closed { animation: slideBg 2s linear reverse forwards; }

  @keyframes slideBg {
    from { background-position: 0 0; }
    to { background-position: -100% 0; }
  }

  button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
</style>
</head>
<body>

<h2>Controle de Portões</h2>
<div id="gates"></div>

<script>
const gates = [
  { id: 1, local: "Frente A", condominio: "Residencial Sol", fechado: true, conflitos: [2] },
  { id: 2, local: "Frente B", condominio: "Residencial Sol", fechado: true, conflitos: [1] },
  { id: 3, local: "Fundos",  condominio: "Residencial Sol", fechado: true, conflitos: [] }
];

const getGate = (id) => gates.find(g => g.id === id);

/* retorna nomes dos portões em conflito */
const getConflicts = (g) => (g.conflitos || []).map(cid => {
  const c = getGate(cid);
  return c ? c.local : `(id ${cid} não encontrado)`;
});

/* true se existir conflito aberto */
const hasOpenConflict = (g) => (g.conflitos || []).some(cid => {
    const c = getGate(cid);
    return c && c.fechado === false;
  });

const canOpen = (gate) => !hasOpenConflict(gate);

function toggleGate(id) {
  const gate = getGate(id);
  if (!gate) return;

  if (gate.fechado) {
    if (!canOpen(gate)) {
      alert("Existe um portão em conflito aberto.");
      return;
    }
    gate.fechado = false;
  }
  else gate.fechado = true;

  render();
}

function render() {
  const container = document.getElementById("gates");
  container.innerHTML = "";

  gates.forEach(gate => {
    const conflictOpen = hasOpenConflict(gate);

    const div = document.createElement("div");
    div.className = `gate ${gate.fechado ? "closed" : "open"}`;

    const btn = document.createElement("button");
    btn.textContent = gate.fechado ? "Abrir" : "Fechar";
    btn.onclick = () => toggleGate(gate.id);

    if (gate.fechado && conflictOpen) {
      btn.disabled = true;
      btn.title = "Intertravamento ativo";
    }

    div.innerHTML = `
      <strong>${gate.condominio}</strong><br>
      Local: ${gate.local}<br>
      Status: ${gate.fechado ? "Fechado" : "Aberto"}<br>
      Conflitos: ${getConflicts(gate).join(", ") || "Nenhum"}<br><br>
    `;

    div.appendChild(btn);
    container.appendChild(div);
  });
}

render();
</script>

</body>
</html>
