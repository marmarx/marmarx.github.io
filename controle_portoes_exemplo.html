<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="author" content="Marco Martins">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Controle de Portões</title>
<style>
  body { font-family: Arial; padding: 20px }
  #gates {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 10px;
  }
  .gate {
    border: 1px solid #ccc;
    padding: 12px;
    border-radius: 6px;
    background-position: 0 0;
    background-size: 200% 100%;
    background-image: linear-gradient(
      to right, #ff6347 0%, #ff6347 50%, #4682b4 50%, #4682b4 100%
    );
  }

  .open { animation: slideBg 2s linear forwards; }
  .closed { animation: slideBg 2s linear reverse forwards; }

  @keyframes slideBg {
    from { background-position: 0 0; }
    to { background-position: -100% 0; }
  }

  button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
</style>
</head>
<body>

<h2>Controle de Portões</h2>
<div id="gates"></div>

<script>
const gates = [
  { id: 1, local: "Frente A", condominio: "Residencial Sol", fechado: true, conflitos: [2] },
  { id: 2, local: "Frente B", condominio: "Residencial Sol", fechado: true, conflitos: [1] },
  { id: 3, local: "Fundos",  condominio: "Residencial Sol", fechado: true, conflitos: [] }
];

const getGate = (id) => gates.find(g => g.id === id);

/* retorna nomes dos portões em conflito */
const getConflicts = (g) => (g.conflitos || []).map(cid => {
  const c = getGate(cid);
  return c ? c.local : `(id ${cid} não encontrado)`;
});

/* true se existir conflito aberto */
const hasOpenConflict = (g) => (g.conflitos || []).some(cid => {
    const c = getGate(cid);
    return c && c.fechado === false;
  });

const canOpen = (gate) => !hasOpenConflict(gate);

function toggleGate(id) {
  const gate = getGate(id);
  if (!gate) return;

  if (gate.fechado) {
    if (!canOpen(gate)) {
      alert("Existe um portão em conflito aberto.");
      return;
    }
    gate.fechado = false;
  }
  else gate.fechado = true;

  syncUI();
}

function syncUI() {
  gates.forEach(g => {
    const el = document.querySelector(`.gate[data-id="${g.id}"]`);
    const btn = el.querySelector("button");

    const conflictOpen = hasOpenConflict(g);

    el.querySelector(".title").textContent = g.condominio;
    el.querySelector(".local").textContent = g.local;
    el.querySelector(".status").textContent = g.fechado ? "Fechado" : "Aberto";
    el.querySelector(".conflicts").textContent = getConflicts(g).join(", ") || "Nenhum";

    let state = ['closed', 'open']
    if (g.fechado) state = ['open', 'closed']
    el.classList.remove(state[0]);
    el.classList.add(state[1]);

    btn.textContent = g.fechado ? "Abrir" : "Fechar";
    btn.disabled = g.fechado && conflictOpen;
    btn.onclick = () => toggleGate(g.id);
  });
}

function renderInitial() {
  const container = document.getElementById("gates");
  container.innerHTML = "";

  gates.forEach(g => {
    const div = document.createElement("div");
    div.className = "gate";
    div.dataset.id = g.id;

    div.innerHTML = `
      <strong class="title"></strong><br>
      Local: <span class="local"></span><br>
      Status: <span class="status"></span><br>
      Conflitos: <span class="conflicts"></span><br><br>
      <button></button>
    `;

    container.appendChild(div);
  });

  syncUI();
}

renderInitial();

</script>

</body>
</html>
